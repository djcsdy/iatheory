\documentclass[twoside,openright]{book}                            
                                                                        
\usepackage[sfdefault]{roboto}   

\usepackage[margin=1in]{geometry}                                       
\setlength\paperwidth{7.5in}                                            
  \setlength\paperheight{9.25in}                                        
 \setlength\textwidth{5.2in}                                            
 \setlength\textheight{7.2in}      

% Math formulas!
\usepackage{amsmath}

 %Nice header with pages numbers                                         
\usepackage{fancyhdr}                                                   
% Make page number appear on botton right                               
\pagestyle{fancy}                                                       
\fancyfoot{}                                                            
\fancyfoot[EL]{\thepage}                                                
\fancyfoot[OR]{\thepage} 

%------------- IMGs ------------------
\usepackage{graphicx}                                                   
\newcommand{\img}[1]{%
\setlength{\fboxsep}{0pt}%
\setlength{\fboxrule}{1pt}%
\fbox{\includegraphics[width=\textwidth]{\base/illu/img/#1}}%
}%
\newcommand{\sbimg}[2]{%
\setlength{\fboxsep}{0pt}%
\setlength{\fboxrule}{1pt}%
\fbox{\includegraphics[width=#1\textwidth]{\base/illu/img/#2}}%
}%
\newcommand{\draw}[1]{%
\setlength{\fboxsep}{0pt}%
\setlength{\fboxrule}{1pt}%
\fbox{\includegraphics[width=\textwidth]{\base/illu/d/#1.png}}%
}%
\newcommand{\sbdraw}[2]{%
\setlength{\fboxsep}{0pt}%
\setlength{\fboxrule}{1pt}%
\fbox{\includegraphics[width=#1\textwidth]{\base/illu/d/#2.png}}%
}%

%------------- NO BORDER IMG ------------------
\usepackage{graphicx}                                                   
\newcommand{\nbimg}[1]{%
\includegraphics[width=\textwidth]{\base/illu/img/#1}%
}%
\newcommand{\nbdraw}[1]{%
\includegraphics[width=\textwidth]{\base/illu/d/#1.png}%
}%

%------------- SCALED IMG ------------------
\newcommand{\simg}[2]{%
{\centering\includegraphics[width=#1\textwidth]{\base/illu/img/#2}\par}%
}%
\newcommand{\sdraw}[2]{%
{\centering\includegraphics[width=#1\textwidth]{\base/illu/d/#2.png}\par}%
}%



%------------- IMGs ------------------

\newcommand{\red}[1]{%
{\color{red}#1}%
}%

%Prevent latex from vertical justifing                                  
\raggedbottom 

\setlength{\parindent}{0em}                                             
\setlength{\parskip}{1em}  

%make footnote stick to the bottom of the page                          
\usepackage[bottom]{footmisc}                                           

% Usage of /href
\usepackage[hidelinks]{hyperref}
% Disable decoration

                                                                        
\usepackage{subfiles}

% ARRAYS
%----------------------------
\usepackage{array}
\usepackage{booktabs}  
% Color header row 
\usepackage[table]{xcolor}
%----------------------------
\usepackage{varwidth} %for the varwidth minipage environment

\newcolumntype{M}{>{\begin{varwidth}{4cm}}l<{\end{varwidth}}} %M is for Maximal column

% Used to force figure to now float (with \begin{figure}[H]).
\usepackage{float}


% Create blank page for print version of the book
\usepackage{afterpage}
\newcommand\blankpage{%
    \null
    \thispagestyle{empty}%
    \addtocounter{page}{-1}%
    \newpage}


% Reduce padding between figure and caption
\usepackage{caption}
\captionsetup{belowskip=-15pt, aboveskip=8pt}

% Cover is a pdf that is included
\usepackage{pdfpages}

% quotes
\usepackage{tcolorbox}
\usepackage{xparse}
\NewDocumentEnvironment{q}{m}
{
\begin{tcolorbox}[parbox=false, sharp corners,after skip=10pt]%
}
{ 

\hspace*{\fill} --- #1\\
\end{tcolorbox}%
}

% Help avoiding line overflow
\emergencystretch 1em

% Remove Chapter "chapter" and chapter number
\usepackage{titlesec}
\usepackage{lipsum}
\titleformat{\chapter}[display]
  {\normalfont\bfseries}{}{0pt}{\Huge}
    
\usepackage{multirow,tabularx} % in the preamble
\newcolumntype{Y}{>{\centering\arraybackslash}X}

% Trivia:
% For trivia left margin
\usepackage{scrextend}
\usepackage{mdframed}
\newmdenv[
  topline=false,
  bottomline=false,
  rightline=false,
]{siderules}

\newenvironment{trivia}{
\begin{siderules}[linewidth=0.7mm,innerrightmargin=0cm,]
\textbf{Trivia:}%
}%
{\end{siderules}}%

% Bibliography
\usepackage[super,square]{natbib}
\bibliographystyle{unsrt}

% To enable figures at the bottom of page
\usepackage{dblfloatfix}

\definecolor{bg_color}{HTML}{EEEEEE}
\usepackage{listings}
\lstset{ 
  backgroundcolor=\color{bg_color},
  breaklines=false,
   frame=single,
   basicstyle=\small\ttfamily,
   xleftmargin=9pt,
   framexleftmargin=5pt,
   showstringspaces=false,
   aboveskip=12pt,
   belowskip=0pt,
   % Make some parts appear in red.
   moredelim=**[is][\color{red}]{@}{@},
}
\lstdefinelanguage
   [x64]{Assembler}     % add a "x64" dialect of Assembler
   [x86masm]{Assembler} % based on the "x86masm" dialect
   % with these extra keywords:
   {morekeywords={CDQE,CQO,CMPSQ,CMPXCHG16B,JRCXZ,LODSQ,MOVSXD, %
                  POPFQ,PUSHFQ,SCASQ,STOSQ,IRETQ,RDTSCP,SWAPGS, %
                  rax,rdx,rcx,rbx,rsi,rdi,rsp,rbp, %
                  r8,r8d,r8w,r8b,r9,r9d,r9w,r9b, %
                  r10,r10d,r10w,r10b,r11,r11d,r11w,r11b, %
                  r12,r12d,r12w,r12b,r13,r13d,r13w,r13b, %
                  r14,r14d,r14w,r14b,r15,r15d,r15w,r15b}} % etc.

\lstset{language=[x64]Assembler}

\definecolor{mGreen}{rgb}{0,0.6,0}
\definecolor{mGray}{rgb}{0.5,0.5,0.5}
\definecolor{keyword_color}{rgb}{0.00,0,1.0}

\lstdefinestyle{CStyle}{
    backgroundcolor=\color{bg_color},   
    commentstyle=\color{mGreen},
    keywordstyle=\color{keyword_color},
    numberstyle=\tiny\color{mGray},
    stringstyle=\color{mGreen},
    breakatwhitespace=false,         
    breaklines=false,                 
    captionpos=b,                    
    keepspaces=true,                                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=1,
    language=C,
    morekeywords={int8_t, int16_t, int32_t, uint8_t, __at}
}

\lstdefinestyle{BashStyle}{
    backgroundcolor=\color{bg_color},   
    commentstyle=\color{mGreen},
    keywordstyle=\color{keyword_color},
    numberstyle=\tiny\color{mGray},
    stringstyle=\color{mGreen},
    breakatwhitespace=false,         
    breaklines=false,                 
    captionpos=b,                    
    keepspaces=true,                                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=1,
    language=C,
    morekeywords={cd, git, ccps}
}

\lstdefinestyle{6502Style}{
    backgroundcolor=\color{bg_color},   
    commentstyle=\color{mGreen},
    keywordstyle=\color{keyword_color},
    numberstyle=\tiny\color{mGray},
    stringstyle=\tiny\color{mGreen},
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=1,
    language=[x86masm]Assembler,
    morekeywords={call, ld, or, jr,ldr, str,ldir, EI, IM, .area,
		.BYTE,LDY,LDX,INC,LDA,BEQ,BNE,JSR,DEY,DEX,PHA,PLA,INY,
		STA,
		}
}

\lstdefinestyle{Z80Style}{
    backgroundcolor=\color{bg_color},   
    commentstyle=\color{mGreen},
    keywordstyle=\color{keyword_color},
    numberstyle=\tiny\color{mGray},
    stringstyle=\color{mGreen},
    breakatwhitespace=false,         
    breaklines=false,                 
    captionpos=b,                    
    keepspaces=true,                                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=1,
    language=[x86masm]Assembler,
    morekeywords={call, ld, or, jr,ldr, str,ldir, EI, IM, .area}
}


\lstdefinestyle{m68kStyle}{
    backgroundcolor=\color{bg_color},   
    commentstyle=\color{mGreen},
    keywordstyle=\color{keyword_color},
    numberstyle=\tiny\color{mGray},
    stringstyle=\color{mGreen},
    breakatwhitespace=false,         
    breaklines=false,                 
    captionpos=b,                    
    keepspaces=true,                                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=1,
    language=[Motorola68k]Assembler,
    morekeywords={.extern, .align, jbsr, dc., move.},
    alsoletter={.}
}

% KANJIS!
\usepackage{CJKutf8}

% Inline code
\usepackage{xcolor}
\definecolor{code_bg_color}{HTML}{CCCCCC}

\usepackage{tcolorbox}
\newtcbox{\entoure}[1][code_bg_color]{on line,
arc=3pt,colback=#1!10!code_bg_color,colframe=#1!50!code_bg_color,
before upper={\rule[-3pt]{0pt}{10pt}},boxrule=0pt,
boxsep=0pt,left=2pt,right=2pt,top=2pt,bottom=.5pt}

% layer colors
\definecolor{mycyan}{HTML}{00FFFF}
\definecolor{mypink}{HTML}{FF00FF}
\definecolor{myyellow}{HTML}{FFFF00}

\definecolor{mask1}{HTML}{ddcc99}
\definecolor{mask2}{HTML}{998855}
\definecolor{mask3}{HTML}{776633}
\definecolor{mask4}{HTML}{554400}


\definecolor{mask5}{HTML}{556677}
\definecolor{mask6}{HTML}{445566}
\definecolor{mask7}{HTML}{99aabb}
\definecolor{mask8}{HTML}{778899}


\definecolor{mask9}{HTML}{223344}
\definecolor{maska}{HTML}{777766}
\definecolor{maskb}{HTML}{666655}
\definecolor{maskc}{HTML}{666666}

\newcommand*{\icode}[1]{\entoure{\texttt{#1}}}

\newcommand{\smallcube}[2]{%
\setlength{\fboxsep}{0pt}%
\setlength{\fboxrule}{1pt}%
\fcolorbox{#1}{#2}{\vphantom{W}\hphantom{H}}%
}


% To categories games
\newcommand{\ocube}{%
\smallcube{black}{gray}%
}
\newcommand{\platcube}{%
\smallcube{black}{cyan}%
}

\newcommand{\beatallcube}{%
\smallcube{black}{magenta}%
}
\newcommand{\shmupcube}{%
\smallcube{black}{yellow}%
}
\newcommand{\duelcube}{%
\smallcube{black}{black}%
}
\newcommand{\po}{%
\smallcube{white}{white}%
}

% Place lstlisting inside minipage to avoid page break inside listing
\lstnewenvironment{code}
{\minipage{\linewidth}}
{\endminipage}

\usepackage{adjustbox}

\usepackage{tikz}
\newcommand*\circled[1]{\tikz[baseline=(char.base)]{\node[shape=circle,draw,inner sep=1pt] (char) {#1};}}

% Used to strike words with \sout
% \usepackage[normalem]{ulem}

% Wrap figure
\usepackage{wrapfig}

\usepackage{amssymb}

% Automagically remove header and footer from empty pages.
\usepackage{emptypage}

%Index stuff
\usepackage{imakeidx}
\makeindex[columns=2, title=Index]

%Remove space above itemize
\usepackage{enumitem}

% for mu symbol    
\usepackage{textcomp}
\usepackage{upgreek}

% To generate version number!
\usepackage{datetime}
\renewcommand{\dateseparator}{, }
\newdateformat{monthyeardate}{\monthname\dateseparator\THEYEAR}

% For end of book empty page (checkoddpage)
\usepackage{ifoddpage}

\begin{document}    
\ifx\forprint\undefined
\includepdf{\base/illu/cover_front.pdf}
\else
\blankpage
\blankpage
\fi

\subfile{src/forewords}

\tableofcontents 

\subfile{src/level_data}

\printindex
\subfile{src/bib}


\ifx\forprint\undefined
   \includepdf{\base/illu/cover_back.pdf}
\else
    % Adding the right number of bankpage automatically at the end is tricky.
    % Doing it manually.
    \blankpage      
    \blankpage 
    \blankpage
\fi

\end{document}
